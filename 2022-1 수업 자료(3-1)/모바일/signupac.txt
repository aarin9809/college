package com.inhatc.afinal;

import android.content.Intent;
import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;

import androidx.appcompat.app.AppCompatActivity;

public class SignupActivity extends AppCompatActivity {
    int version = 1;
    MyDatabaseHelper helper;
    SQLiteDatabase database;

    String sql;
    Cursor cursor;

    Button btnIdCheck, btnSignup;
//    ArrayList<String> aryMBRList;
//    ArrayAdapter<String> adtMembers;
//    ListView lstView;
//    String strRecord = null;

    EditText editName, editId, editPw, editPwCheck;
//    String user_id, user_pw, user_name;

    int flag = 2;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_signup);

        editName = (EditText) findViewById(R.id.editName);
        editId = (EditText) findViewById(R.id.editId);
        editPw = (EditText) findViewById(R.id.editPw);
        editPwCheck = (EditText) findViewById(R.id.editPwCheck);

        btnIdCheck = (Button) findViewById(R.id.btnIdCheck);
        helper = new MyDatabaseHelper(this);
        database = helper.getWritableDatabase();

        //https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=daksul1&logNo=220988976110
        btnIdCheck.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                String name = editName.getText().toString();
                String id = editId.getText().toString();
                String pw = editPw.getText().toString();
                String pwck = editPwCheck.getText().toString();

                sql = "SELECT * FROM " + helper.TABLE_NAME + " WHERE user_id = '" + id + "'";
                cursor = database.rawQuery(sql, null);

                if (cursor.getCount() != 0) {
                    Toast toast = Toast.makeText(SignupActivity.this, "이미 존재하는 아이디입니다.", Toast.LENGTH_LONG);
                    toast.show();
                    flag = 1;
                } else {
                    Toast toast = Toast.makeText(SignupActivity.this, "사용 가능한 아이디입니다.", Toast.LENGTH_LONG);
                    toast.show();
                    flag = 0;
                }
            }
        });

        btnSignup = (Button) findViewById(R.id.btnSignup);
        btnSignup.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                String name = editName.getText().toString();
                String id = editId.getText().toString();
                String pw = editPw.getText().toString();
                String pwck = editPwCheck.getText().toString();

                sql = "SELECT user_id FROM " + helper.TABLE_NAME + " WHERE user_id = '" + id + "'";
                cursor = database.rawQuery(sql, null);

                if (name.length() == 0 || id.length() == 0 || pw.length() == 0 || pwck.length() == 0) {
                    Toast toast = Toast.makeText(SignupActivity.this, "모든 항목을 입력해주세요.", Toast.LENGTH_LONG);
                    toast.show();
                    return;
                } else {
                    if (flag == 2) {
                        Toast toast = Toast.makeText(SignupActivity.this, "아이디 중복체크가 필요합니다.", Toast.LENGTH_LONG);
                        toast.show();
                        return;
                    } else if (flag == 1) {
                        Toast toast = Toast.makeText(SignupActivity.this, "이미 존재하는 아이디입니다.", Toast.LENGTH_LONG);
                        toast.show();
                        return;
                    } else {
                        if (!pw.equals(pwck)) {
                            Toast toast = Toast.makeText(SignupActivity.this, "비밀번호가 일치하지 않습니다.", Toast.LENGTH_LONG);
                            toast.show();
                            return;
                        } else {
                            helper.addUser(database, id, pw, name);
                            Toast toast = Toast.makeText(SignupActivity.this, "가입이 완료되었습니다.", Toast.LENGTH_LONG);
                            toast.show();
                            Intent intent = new Intent(getApplicationContext(), SigninActivity.class);
                            startActivity(intent);
                            finish();
                        }
                    }
                }
            }
        });
    }
}
//        myDB = this.openOrCreateDatabase("UserInfo", MODE_PRIVATE, null);
//
//        if (myDB == null) {
//            myDB.execSQL("Create table UserInfo(" +
//                    "_id integer primary key autoincrement, " +
//                    "Name text not null, " + "Id text not null, " + "Pw text not null);");
//        }
//
//        if (myDB != null) myDB.close();
//    }
//
//    public void onClick(View v) {
//        myDB = this.openOrCreateDatabase("UserInfo", MODE_PRIVATE, null);
//        user_id = editId.getText().toString();
//        if (v == btnIdCheck) {
//            if (user_id.equals("")) {
//                Toast nullId = Toast.makeText(this, "아이디를 입력해주세요", Toast.LENGTH_LONG);
//                nullId.show();
//            } else {
//            }
//
//
//        } else if (v == btnSignup) {
//
//        }
//    }
//
//    public void getDBData(String strWhere) {
//        cursor = myDB.query("UserInfo", null, strWhere, null,
//                null, null, null, null);
//
//        aryMBRList = new ArrayList<String>();
//        if (cursor != null) {
//            if (cursor.moveToFirst()) {
//                do {
//                    strRecord = cursor.getString(2);
//                    aryMBRList.add(strRecord);
//                } while (cursor.moveToNext());
//            }
//        }
//
//        adtMembers = new ArrayAdapter<String>(this, android.R.layout.simple_list_item_single_choice, aryMBRList);
//
//        lstView.setAdapter(adtMembers);
//        lstView.setChoiceMode(ListView.CHOICE_MODE_SINGLE);
//    }